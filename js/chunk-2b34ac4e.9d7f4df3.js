(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b34ac4e"],{"028d":function(t,e,n){"use strict";var i=n("a16d"),s=n.n(i);s.a},"0496":function(t,e,n){var i=n("efe2");t.exports=function(t){return i((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},"1ec9":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-flow h100"},[n("Menu"),n("D3Tree",{ref:"graph",attrs:{enableCircleLink:!1,defaultWidth:t.width,defaultHeight:t.height,defaultNodes:t.nodes,defaultLinks:t.links,iconData:t.iconData,transform:t.transform,IOCircleOffset:18},on:{svgDrop:t.svgDrop,nodeContextMenu:t.nodeContextMenu,fullScreen:t.fullscreen,linkContextMenu:t.linkContextMenu,nodeSelectChange:t.nodeSelectChange,linkSelectChange:t.linkSelectChange,resetNodeMenu:t.resetNodeMenu,resetLinkMenu:t.resetLinkMenu,action:t.handleActions}},[n("div",[n("ul",{directives:[{name:"show",rawName:"v-show",value:t.nodeMenuData.show,expression:"nodeMenuData.show"}],staticClass:"graph-node-menu",style:"top: "+t.nodeMenuData.top+"px;left: "+t.nodeMenuData.left+"px"},[n("li",{on:{click:t.nodeEdit}},[t._v("编辑")]),n("li",{on:{click:t.nodeDelete}},[t._v("删除")])]),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.linkMenuData.show,expression:"linkMenuData.show"}],staticClass:"graph-node-menu",style:"top: "+t.linkMenuData.top+"px;left: "+t.linkMenuData.left+"px"},[n("li",{on:{click:t.linkEdit}},[t._v("编辑备注")]),n("li",{on:{click:t.linkDelete}},[t._v("删除")])])])]),n("PropertyPanel")],1)},s=[],o=(n("31a0"),n("e793")),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"graph-container h100",class:{"full-screen":t.fullScreen}},[n("div",{staticClass:"operation-panel"},[n("div",{staticClass:"relative"},[n("svg",{staticClass:"icon icon-enlarge",attrs:{viewBox:"0 0 1024 1024"},on:{click:function(e){return t.svgZoom(!0)}}},[n("path",{attrs:{d:"M696.32 732.16C634.88 788.48 552.96 819.2 460.8 819.2c-199.68 0-358.4-158.72-358.4-358.4s158.72-358.4 358.4-358.4 358.4 158.72 358.4 358.4c0 92.16-30.72 174.08-87.04 235.52l5.12 5.12 204.8 204.8c10.24 10.24 10.24 25.6 0 35.84-10.24 10.24-25.6 10.24-35.84 0l-209.92-209.92zM460.8 768c168.96 0 307.2-138.24 307.2-307.2s-138.24-307.2-307.2-307.2-307.2 138.24-307.2 307.2 138.24 307.2 307.2 307.2z m-25.6-332.8V307.2c0-15.36 10.24-25.6 25.6-25.6s25.6 10.24 25.6 25.6v128H614.4c15.36 0 25.6 10.24 25.6 25.6s-10.24 25.6-25.6 25.6H486.4V614.4c0 15.36-10.24 25.6-25.6 25.6s-25.6-10.24-25.6-25.6V486.4H307.2c-15.36 0-25.6-10.24-25.6-25.6s10.24-25.6 25.6-25.6h128z","p-id":"2853"}})]),n("p",{staticClass:"tips"},[t._v(" 放大 ")])]),n("div",{staticClass:"relative"},[n("svg",{staticClass:"icon icon-shrink",attrs:{viewBox:"0 0 1024 1024"},on:{click:function(e){return t.svgZoom(!1)}}},[n("path",{attrs:{d:"M696.32 732.16C634.88 788.48 552.96 819.2 460.8 819.2c-199.68 0-358.4-158.72-358.4-358.4s158.72-358.4 358.4-358.4 358.4 158.72 358.4 358.4c0 92.16-30.72 174.08-87.04 235.52l5.12 5.12 204.8 204.8c10.24 10.24 10.24 25.6 0 35.84-10.24 10.24-25.6 10.24-35.84 0l-209.92-209.92zM460.8 768c168.96 0 307.2-138.24 307.2-307.2s-138.24-307.2-307.2-307.2-307.2 138.24-307.2 307.2 138.24 307.2 307.2 307.2zM307.2 435.2h307.2c15.36 0 25.6 10.24 25.6 25.6s-10.24 25.6-25.6 25.6H307.2c-15.36 0-25.6-10.24-25.6-25.6s10.24-25.6 25.6-25.6z","p-id":"2853"}})]),n("p",{staticClass:"tips"},[t._v(" 缩小 ")])]),n("div",{staticClass:"relative"},[n("svg",{staticClass:"icon icon-reset",attrs:{viewBox:"0 0 1024 1024"},on:{click:function(e){return t.svgZoom(!0,1)}}},[n("path",{attrs:{d:"M256 102.4h512c87.04 0 153.6 66.56 153.6 153.6v512c0 87.04-66.56 153.6-153.6 153.6H256c-87.04 0-153.6-66.56-153.6-153.6V256c0-87.04 66.56-153.6 153.6-153.6z m0 51.2c-56.32 0-102.4 46.08-102.4 102.4v512c0 56.32 46.08 102.4 102.4 102.4h512c56.32 0 102.4-46.08 102.4-102.4V256c0-56.32-46.08-102.4-102.4-102.4H256z m25.6 307.2h204.8c40.96 0 76.8 35.84 76.8 76.8v204.8c0 40.96-35.84 76.8-76.8 76.8h-204.8c-40.96 0-76.8-35.84-76.8-76.8v-204.8C204.8 496.64 240.64 460.8 281.6 460.8z m0 51.2c-15.36 0-25.6 10.24-25.6 25.6v204.8c0 15.36 10.24 25.6 25.6 25.6h204.8c15.36 0 25.6-10.24 25.6-25.6v-204.8c0-15.36-10.24-25.6-25.6-25.6h-204.8z","p-id":"2853"}})]),n("p",{staticClass:"tips"},[t._v(" 实际尺寸 ")])]),n("div",{staticClass:"relative"},[n("svg",{staticClass:"icon icon-adjust-screen",attrs:{viewBox:"0 0 1024 1024"},on:{click:t.adjustScreen}},[n("path",{attrs:{d:"M353.28 721.92c0-30.72-20.48-51.2-51.2-51.2H128c-15.36 0-25.6-10.24-25.6-25.6 0-20.48 10.24-30.72 25.6-30.72H307.2c56.32 0 102.4 46.08 102.4 102.4v179.2c0 15.36-10.24 25.6-25.6 25.6s-25.6-10.24-25.6-25.6v-174.08z m317.44 0v174.08c0 15.36-10.24 25.6-25.6 25.6s-25.6-10.24-25.6-25.6V716.8c0-56.32 46.08-102.4 102.4-102.4h179.2c15.36 0 25.6 10.24 25.6 25.6s-10.24 25.6-25.6 25.6h-174.08c-35.84 5.12-56.32 25.6-56.32 56.32zM353.28 302.08V128c0-15.36 15.36-25.6 30.72-25.6s25.6 10.24 25.6 25.6V307.2c0 56.32-46.08 102.4-102.4 102.4H128c-15.36 0-25.6-10.24-25.6-25.6s10.24-25.6 25.6-25.6h174.08c30.72-5.12 51.2-25.6 51.2-56.32z m317.44 0c0 30.72 20.48 51.2 51.2 51.2h174.08c15.36 0 25.6 10.24 25.6 25.6s-10.24 30.72-25.6 30.72H716.8c-56.32 0-102.4-46.08-102.4-102.4V128c0-15.36 10.24-25.6 25.6-25.6s25.6 10.24 25.6 25.6v174.08z","p-id":"2853"}})]),n("p",{staticClass:"tips"},[t._v(" 适应屏幕 ")])]),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.fullScreen,expression:"!fullScreen"}],staticClass:"relative"},[n("svg",{staticClass:"icon icon-full-screen",attrs:{viewBox:"0 0 1024 1024"},on:{click:function(e){return t.setFullScreen(!0)}}},[n("path",{attrs:{d:"M834.56 153.6h-194.56c-15.36 0-25.6-10.24-25.6-25.6s10.24-25.6 25.6-25.6H819.2c56.32 0 102.4 46.08 102.4 102.4v179.2c0 15.36-10.24 25.6-25.6 25.6s-25.6-10.24-25.6-25.6V204.8v-15.36l-235.52 235.52c-10.24 10.24-25.6 10.24-35.84 0-10.24-10.24-10.24-25.6 0-35.84L834.56 153.6z m-5.12 711.68l-230.4-230.4c-10.24-10.24-10.24-25.6 0-35.84 10.24-10.24 25.6-10.24 35.84 0l230.4 230.4V640c0-15.36 10.24-25.6 25.6-25.6s25.6 10.24 25.6 25.6V819.2c0 56.32-46.08 102.4-102.4 102.4h-179.2c-15.36 0-25.6-10.24-25.6-25.6s10.24-25.6 25.6-25.6h174.08c10.24-5.12 15.36-5.12 20.48-5.12zM194.56 158.72l230.4 230.4c10.24 10.24 10.24 25.6 0 35.84-10.24 10.24-25.6 10.24-35.84 0L158.72 194.56V384c0 15.36-15.36 25.6-30.72 25.6S102.4 399.36 102.4 384V204.8c0-56.32 46.08-102.4 102.4-102.4h179.2c15.36 0 25.6 10.24 25.6 25.6s-10.24 30.72-25.6 30.72H194.56z m0 706.56H384c15.36 0 25.6 10.24 25.6 25.6 0 20.48-10.24 30.72-25.6 30.72H204.8c-56.32 0-102.4-46.08-102.4-102.4v-179.2c0-15.36 10.24-25.6 25.6-25.6s25.6 10.24 25.6 25.6V829.44l230.4-230.4c10.24-10.24 25.6-10.24 35.84 0 10.24 10.24 10.24 25.6 0 35.84l-225.28 230.4z","p-id":"2964"}})]),n("p",{staticClass:"tips"},[t._v(" 全屏 ")])]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.fullScreen,expression:"fullScreen"}],staticClass:"relative"},[n("svg",{staticClass:"icon icon-full-screen",attrs:{viewBox:"0 0 1024 1024"},on:{click:function(e){return t.setFullScreen(!1)}}},[n("path",{attrs:{d:"M834.56 153.6h-194.56c-15.36 0-25.6-10.24-25.6-25.6s10.24-25.6 25.6-25.6H819.2c56.32 0 102.4 46.08 102.4 102.4v179.2c0 15.36-10.24 25.6-25.6 25.6s-25.6-10.24-25.6-25.6V204.8v-15.36l-235.52 235.52c-10.24 10.24-25.6 10.24-35.84 0-10.24-10.24-10.24-25.6 0-35.84L834.56 153.6z m-5.12 711.68l-230.4-230.4c-10.24-10.24-10.24-25.6 0-35.84 10.24-10.24 25.6-10.24 35.84 0l230.4 230.4V640c0-15.36 10.24-25.6 25.6-25.6s25.6 10.24 25.6 25.6V819.2c0 56.32-46.08 102.4-102.4 102.4h-179.2c-15.36 0-25.6-10.24-25.6-25.6s10.24-25.6 25.6-25.6h174.08c10.24-5.12 15.36-5.12 20.48-5.12zM194.56 158.72l230.4 230.4c10.24 10.24 10.24 25.6 0 35.84-10.24 10.24-25.6 10.24-35.84 0L158.72 194.56V384c0 15.36-15.36 25.6-30.72 25.6S102.4 399.36 102.4 384V204.8c0-56.32 46.08-102.4 102.4-102.4h179.2c15.36 0 25.6 10.24 25.6 25.6s-10.24 30.72-25.6 30.72H194.56z m0 706.56H384c15.36 0 25.6 10.24 25.6 25.6 0 20.48-10.24 30.72-25.6 30.72H204.8c-56.32 0-102.4-46.08-102.4-102.4v-179.2c0-15.36 10.24-25.6 25.6-25.6s25.6 10.24 25.6 25.6V829.44l230.4-230.4c10.24-10.24 25.6-10.24 35.84 0 10.24 10.24 10.24 25.6 0 35.84l-225.28 230.4z","p-id":"2964"}})]),n("p",{staticClass:"tips"},[t._v(" 退出全屏 ")])])]),n("svg",{ref:"graphSvg",staticClass:"direct-graph-svg J_graph_svg",class:{active:t.svgActive},on:{contextmenu:t.svgContextMenu,mousedown:t.svgMouseDown,mouseup:t.svgMouseUp,mousemove:t.svgMouseMove,drop:t.svgDrop,dragover:t.allowDrop,mouseleave:t.svgMouseLeave}},[n("defs",[n("linearGradient",{attrs:{id:"linear-rect-bg"}},[n("stop",{staticStyle:{"stop-color":"#99fffc"},attrs:{offset:"0%"}}),n("stop",{staticStyle:{"stop-color":"#adffe5"},attrs:{offset:"100%"}})],1),n("linearGradient",{attrs:{id:"linear-link-stroke"}},[n("stop",{staticStyle:{"stop-color":"#0C8CFA"},attrs:{offset:"0%"}}),n("stop",{staticStyle:{"stop-color":"#81C3FC"},attrs:{offset:"50%"}}),n("stop",{staticStyle:{"stop-color":"#0C8CFA"},attrs:{offset:"100%"}})],1),n("marker",{attrs:{id:"end-arrow",viewBox:"0 -5 10 10",refX:"6",markerWidth:"9",markerHeight:"9",orient:"auto",markerUnits:"userSpaceOnUse"}},[n("path",{attrs:{d:"M3,-5L10,0L3,5",fill:"#0C8CFA"}})]),n("filter",{attrs:{x:"-0.1",y:"-0.1",width:"1.2",height:"1.2",id:"link-text-bg"}},[n("feFlood",{attrs:{"flood-color":"#fff"}}),n("feComposite",{attrs:{in:"SourceGraphic"}})],1)],1),n("g",{staticClass:"graph J_graph",attrs:{transform:"translate(0,0) scale(1)"}},[n("path",{directives:[{name:"show",rawName:"v-show",value:t.showDragLine,expression:"showDragLine"}],staticClass:"link dragline",staticStyle:{"marker-end":"url(#end-arrow)"},attrs:{d:t.dragLinePath}}),t._l(t.links,(function(e,i){return n("g",[n("path",{key:"link-bg-"+i,staticClass:"link-bg",attrs:{d:t.pathLink(e)},on:{click:function(e){return t.pathLinkClick(i)},contextmenu:function(n){return t.pathLinkContextMenu(e,i,n)}}}),n("path",{key:i,staticClass:"link",class:{selected:i==t.activeLinkIndex},staticStyle:{"marker-start":"none","marker-end":"url(#end-arrow)"},attrs:{d:t.pathLink(e)},on:{click:function(e){return t.pathLinkClick(i)},contextmenu:function(n){return t.pathLinkContextMenu(e,i,n)}}}),n("circle",{directives:[{name:"show",rawName:"v-show",value:!!e.text,expression:"!!link.text"}],staticClass:"link-desc-circle",attrs:{r:"4",fill:"#0c8cfa",cx:t.linkTextPos(e).x,cy:t.linkTextPos(e).y,stroke:"#D2EAFF","stroke-width":"2"},on:{contextmenu:function(n){return t.pathLinkContextMenu(e,i,n)}}}),n("text",{directives:[{name:"show",rawName:"v-show",value:!!e.text,expression:"!!link.text"}],staticClass:"link-text",attrs:{x:t.linkTextPos(e).x+30,y:t.linkTextPos(e).y,filter:"url(#link-text-bg)"}},[t._v(" "+t._s(e.text?t.ellipse(e.text,40):"")+" ")])])})),n("g",t._l(t.nodes,(function(e,i){return n("g",{key:i,staticClass:"J_g_node",attrs:{transform:"translate("+e.x+","+e.y+")","data-key":i}},[n("g",[n("rect",{staticClass:"node-rect",class:{active:t.activeRectIndex==i,selected:t.activeNode&&t.activeNode.id===e.id},attrs:{x:"-115",y:-t.IOCircleOffset,width:"230",height:2*t.IOCircleOffset,rx:t.IOCircleOffset,"data-key":i},on:{contextmenu:function(n){return t.nodeRectContextMenu(e,n)},click:function(n){return t.nodeRectClick(e)}}}),n("text",{staticClass:"node-text",attrs:{x:"-13",y:"4","data-key":i}},[t._v(" "+t._s(e.text?t.ellipse(e.text,18):"节点"+e.id)+" ")]),n("circle",{staticClass:"node-circle",attrs:{r:"5",cy:t.IOCircleOffset,"data-key":i},on:{mousedown:function(n){return t.outputCircleMouseDown(e,n)}}}),n("circle",{staticClass:"node-circle-lg",class:{normal:!t.mousedownCircleNode},attrs:{r:"10",cy:-t.IOCircleOffset,"data-key":i},on:{mouseup:function(n){return t.inputCircleMouseUp(e,n)}}}),n("circle",{staticClass:"node-circle spec",attrs:{r:"5",cy:-t.IOCircleOffset}})]),e.leftIcon?n("g",{class:"svg-left-icon svg-"+e.leftIcon,attrs:{transform:"translate(-105, -12)"},domProps:{innerHTML:t._s(t.iconData[e.leftIcon])}}):t._e(),e.rightIcon?n("g",{class:"svg-right-icon svg-"+e.rightIcon,attrs:{transform:"translate(59, -12)"},domProps:{innerHTML:t._s(t.iconData[e.rightIcon])}}):t._e(),n("g",{attrs:{transform:"translate(91, 0)"}},[n("circle",{staticClass:"node-context-menu-circle",attrs:{fill:"#fff",r:"12",transform:"translate(4, 0)"},on:{click:function(n){return t.nodeRectContextMenu(e,n)}}}),n("circle",{staticClass:"context-menu-point",attrs:{r:"1",fill:"#333"}}),n("circle",{staticClass:"context-menu-point",attrs:{r:"1",cx:"4",fill:"#333"}}),n("circle",{staticClass:"context-menu-point",attrs:{r:"1",cx:"8",fill:"#333"}})])])})),0)],2)]),t._t("default")],2)},c=[],r=(n("b4fb"),n("dbb3"),n("4194"),n("3466"),n("fe59"),n("ecb4"),n("2eeb"),n("77ad"),n("ea69"),n("513c"),n("e18c"),n("e35a"),n("1c2e"),n("34d9"),n("96db"),n("f4e3"),n("08ba"),n("af86"),n("1998")),l=n("5748"),d=n("715e"),u=function(t,e){var n=t||window.event,i=e||n.target||n.srcElement;return{offsetX:n.clientX-i.getBoundingClientRect().left,offsetY:n.clientY-i.getBoundingClientRect().top}},h=function(t){return"[object Array]"===Object.prototype.toString.call(t)},f={name:"DirectedGraphEditor",props:{defaultWidth:{type:Number,default:900},defaultHeight:{type:Number,default:600},enableCircleLink:{type:Boolean,default:!1},defaultNodes:{type:Array,default:function(){return[]}},defaultLinks:{type:Array,default:function(){return[]}},iconData:{type:Object,default:function(){return{}}},transform:{type:Object,default:function(){return{x:0,y:0,k:1}}},IOCircleOffset:{type:Number,default:18}},data:function(){return{width:this.defaultWidth,height:this.defaultHeight,activeNode:null,mousedownCircleNode:null,mouseupCircleNode:null,svg:null,nodes:this.defaultNodes,links:this.defaultLinks,svgActive:!1,showDragLine:!1,dragLinePath:"M0,0L0,0",activeRectIndex:-1,activeLinkIndex:-1,zoom:null,fullScreen:!1}},mounted:function(){this.checkDataValid(),this.svg=d["d"](".J_graph_svg"),this.initZoom(),this.initNodeRectDrag(),this.adjustScreen()},methods:{ellipse:function(t,e){for(var n=0,i=e,s=0;s<t.length;s++){var o=t.charAt(s);if(/^[\u4e00-\u9fa5]$/.test(o)?n+=2:n+=1,n>e){i=s;break}}return"".concat(t.slice(0,i)).concat(i<t.length?"...":"")},getSvgEle:function(){return this.$refs.graphSvg},initZoom:function(){var t=this,e=this;this.zoom=d["f"]().scaleExtent([.4,5]).translateExtent([[-5e3,-5e3],[5e3,5e3]]).on("start",(function(){e.$emit("resetLinkMenu"),e.$emit("resetNodeMenu"),e.mousedownCircleNode||(e.activeNode=null,e.svgMouseDown(),e.svg.classed("active",!1))})).on("zoom",(function(){if(!e.mousedownCircleNode){var t=d["b"].transform,n=t.x,i=t.y,s=t.k;d["d"](".J_graph").attr("transform",d["g"].translate(n,i).scale(s))}})).on("end",(function(){e.svgMouseUp(),e.mousedownCircleNode||e.svg.classed("active",!1)})).filter((function(e){return!("mousedown"===d["b"].type&&t.mousedownCircleNode)})),e.svg.call(this.zoom).on("wheel.zoom",null),e.svg.call(this.zoom.transform,d["g"].translate(this.transform.x,this.transform.y).scale(this.transform.k))},initNodeRectDrag:function(){var t,e=this,n=this;d["e"](".J_g_node").call(d["a"]().on("start",(function(n){t={x:d["b"].x,y:d["b"].y},d["b"].sourceEvent.stopPropagation(),e.activeLinkIndex=-1,e.$emit("resetLinkMenu"),e.$emit("resetNodeMenu")})).on("drag",(function(t){d["b"].sourceEvent.stopPropagation();var e=d["b"],i=e.dx,s=e.dy,o=d["d"](this).attr("data-key");n.activeRectIndex=o,n.nodes[o].x+=i,n.nodes[o].y+=s})).on("end",(function(i){var s=d["b"],o=s.x,a=s.y,c=t,r=c.x,l=c.mouseDownY;(Math.abs(r-o)>5||Math.abs(l-a)>5)&&e.$emit("action",{type:"nodeDragEnd"}),n.activeRectIndex=-1,d["b"].sourceEvent.stopPropagation()})))},checkDataValid:function(){if(!h(this.nodes)||!h(this.links))throw new Error("nodes数据和links数据必须为数组");var t=this.nodes.length,e=new Set(this.nodes.map((function(t){return t.id})));if(e.size!==t)throw new Error("提供的nodes数据中有重复id项");var n=new Set([]);if(this.links.forEach((function(t){n.add("".concat(t.source,"@").concat(t.target)),n.add("".concat(t.target,"@").concat(t.source))})),n.size<2*this.links.length)throw new Error("提供的links数据中有双向连接或重复项")},svgZoom:function(t,e){if(e)this.zoom.scaleTo(d["d"](this.svg.node()),e);else{var n=t?1.1:.9;this.zoom.scaleBy(d["d"](this.svg.node()),n)}},setFullScreen:function(t){this.fullScreen=t,this.$emit("fullScreen",t)},adjustScreen:function(){var t=d["d"](this.svg.node()),e=document.getElementsByClassName("J_graph")[0],n=this.svg.node().getBoundingClientRect(),i=e.getBoundingClientRect(),s=n.width/i.width,o=n.height/i.height,a=1,c=1;a=s<o?s:o;var r=a;c=r>1?1:r,this.zoom.scaleBy(t,c);var l=e.getAttribute("transform").match(/scale\(([.\d]+)\)/),u=l&&l[1]?parseFloat(l[1]):1,h=e.getBoundingClientRect(),f=n.x,v=n.y,p=n.width,g=n.height,m=n.top,k=n.left,x=h.x,C=h.y,w=h.width,M=h.height,y=h.top,D=h.left,N=f||k||0,L=x||D||0,b=v||m||0,S=C||y||0,z=N+p/2-w/2-L,_=b+g/2-M/2-S;this.zoom.translateBy(t,z/u,_/u)},svgContextMenu:function(t){return t.preventDefault(),!1},pathLink:function(t){var e=this.nodes.find((function(e){return e.id===t.source})),n=this.nodes.find((function(e){return e.id===t.target})),i=n.x-e.x,s=n.y-e.y,o=Math.sqrt(i*i+s*s),a=i/o,c=this.IOCircleOffset+10,r=-(this.IOCircleOffset+12),l=0,u=-6*a,h=e.x+l,f=e.y+c-2,v=n.x+u,p=n.y+r;if(p<f){var g=(f-p)/2;return"M".concat(h,",").concat(f,"C").concat(h,",").concat(f+g,",").concat(v,",").concat(p-g,",").concat(v,",").concat(p)}return d["c"]()({source:[h,f],target:[v,p]})},linkTextPos:function(t){var e=this.nodes.find((function(e){return e.id===t.source})),n=this.nodes.find((function(e){return e.id===t.target})),i=0;return n.y<e.y&&(i=Math.abs(n.x-e.x)<30?(n.x-e.x)/10:n.x>e.x?-3:3),{x:(e.x+n.x)/2+i,y:(e.y+n.y)/2}},pathLinkClick:function(t){this.activeLinkIndex=t},pathLinkContextMenu:function(t,e,n){this.$emit("linkContextMenu",{link:t,index:e,e:n})},nodeRectClick:function(t){this.activeNode=t},nodeRectContextMenu:function(t,e){e.preventDefault(),e.stopPropagation(),this.activeNode=t,this.$emit("nodeContextMenu",{node:t,e:e})},outputCircleMouseDown:function(t,e){e.stopPropagation(),this.$emit("resetLinkMenu"),this.mousedownCircleNode=t,this.activeLinkIndex=-1,this.showDragLine=!0,this.dragLinePath="M".concat(this.mousedownCircleNode.x,",").concat(this.mousedownCircleNode.y+16,"L").concat(this.mousedownCircleNode.x,",").concat(this.mousedownCircleNode.y+16)},inputCircleMouseUp:function(t,e){if(e.stopPropagation(),this.mousedownCircleNode){this.showDragLine=!1,this.mouseupCircleNode=t;var n=this.mousedownCircleNode.id,i=this.mouseupCircleNode.id;if(i!==n){var s=this.containsLink(n,i),o=s.exists;if(!o){if(!this.enableCircleLink&&this.circleLinkCheck(t))throw new Error("不允许有环形关系");this.links.splice(this.links.length,0,{source:n,target:i}),this.$emit("action",{type:"addLink"})}this.mousedownCircleNode=null}else this.resetMouseArgs()}},circleLinkCheck:function(){try{this.deepTraversal(this.mouseupCircleNode,[])}catch(t){return console.log(t),!0}return!1},deepTraversal:function(t,e){var n=this;if(t){e.push(t.id);var i=[];this.links.forEach((function(s){var o=s.source,a=s.target;if(o===t.id){if(-1!==e.indexOf(a))throw new Error("不允许出现循环连接");if(a===n.mousedownCircleNode.id)throw new Error("不允许出现循环连接");i.push(n.nodes.find((function(t){return t.id===a})))}}));for(var s=0;s<i.length;s++)this.deepTraversal(i[s],Object(l["a"])(e))}},svgMouseDown:function(){this.svgActive=!0,this.activeLinkIndex=-1},svgMouseMove:function(t){if(this.mousedownCircleNode){var e=this.mousedownCircleNode,n=e.x,i=e.y,s=u(t,this.$refs.graphSvg),o=s.offsetX,a=s.offsetY,c=d["h"](this.svg.node()),l=c.invert([o,a]),h=Object(r["a"])(l,2),f=h[0],v=h[1];this.dragLinePath=d["c"]()({source:[n,i+this.IOCircleOffset+6],target:[f,v]})}},svgMouseLeave:function(t){this.showDragLine=!1,this.resetMouseArgs()},svgMouseUp:function(t){this.mousedownCircleNode&&(this.showDragLine=!1),this.svgActive=!1,this.resetMouseArgs()},svgDrop:function(t){t.preventDefault(),this.$emit("svgDrop",t)},allowDrop:function(t){t.preventDefault()},getGraphData:function(){var t=d["h"](this.svg.node());return{nodes:this.nodes||[],links:this.links||[],svgTransform:t}},addNode:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,s=d["h"](this.svg.node()),o=s.invert([e,n]),a=Object(r["a"])(o,2),c=a[0],l=a[1];if(i=i?Object.assign(i,{x:c,y:l}):{id:this.randomString(6),x:c,y:l},this.containsNode(i.id).exists)throw new Error("当前图中已存在该id的节点");this.nodes.splice(this.nodes.length,0,i),this.$emit("action",{type:"addNode"}),this.$nextTick((function(){t.initNodeRectDrag()}))},removeNode:function(t){var e=this.containsNode(t),n=e.index,i=e.exists;i&&(this.activeNode.id===t&&(this.activeNode=null),this.links=this.links.filter((function(e){return e.target!==t&&e.source!==t})),this.nodes.splice(n,1),this.$emit("action",{type:"removeNode"}))},setNodeData:function(t,e){var n=this,i=this.containsNode(t),s=i.exists,o=i.node,a=i.index;s&&("function"===typeof e?this.nodes.splice(a,1,e(o)):this.nodes.splice(a,1,e),this.$emit("action",{type:"updateNode"}),this.$nextTick((function(){n.initNodeRectDrag()})))},getNodeData:function(t){return this.nodes.find((function(e){return e.id===t}))||null},setNodesData:function(t){var e=this;this.nodes="function"===typeof t?t(this.nodes):t,this.$emit("action",{type:"updateNodes"}),this.$nextTick((function(){e.initNodeRectDrag()}))},setLinksData:function(t){this.links="function"===typeof t?t(this.links):t,this.$emit("action",{type:"updateLinks"})},addLink:function(t){var e=this.containsLink(t.source,t.target),n=e.exists;if(n)throw new Error("添加的连接在连接数据中已存在");this.links.splice(this.links.length,0,t),this.$emit("action",{type:"addLink"})},setLinkData:function(t,e,n){var i=this.containsLink(t,e),s=i.exists,o=i.index,a=i.link;s&&("function"===typeof n?this.links.splice(o,1,n(a)):this.links.splice(o,1,n),this.$emit("action",{type:"updateLink"}))},removeLink:function(t,e){var n=this.containsLink(t,e),i=n.index,s=n.exists;s&&(this.links.splice(i,1),this.activeLinkIndex=-1,this.$emit("action",{type:"removeLink"}))},randomString:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e="abcdefghijklmnopqrstuvwxyz0123456789",n=e.length,i="",s=0;s<t;s++)i+=e.charAt(Math.floor(Math.random()*n));return i},containsNode:function(t){var e=this.nodes.findIndex((function(e){return e.id===t})),n=e>=0;return{exists:n,index:e,node:n?this.nodes[e]:null}},containsLink:function(t,e){var n=this.links.findIndex((function(n){return n.source==t&&n.target==e||n.target==t&&n.source==e})),i=n>=0;return{exists:i,index:n,link:i?this.links[n]:null}},resetMouseArgs:function(){this.mousedownCircleNode=null,this.mouseupCircleNode=null,this.activeLinkIndex=-1},setSelectedNode:function(t){var e=this.nodes.find((function(e){return e.id===t}));if(!e)throw new Error("图中该id节点不存在");return(!this.activeNode||this.activeNode&&this.activeNode.id!==e.id)&&(this.activeNode=e),e}},watch:{activeNode:function(t){this.$emit("nodeSelectChange",t)},activeLinkIndex:function(t){this.$emit("linkSelectChange",{link:t>0?this.links[t]:null,index:t})},transform:function(t){this.svg.call(this.zoom.transform,d["g"].translate(this.transform.x,this.transform.y).scale(this.transform.k))}}},v=f,p=(n("842c"),n("9ca4")),g=Object(p["a"])(v,a,c,!1,null,"40cf5bc2",null),m=g.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"node-add-menu"},[n("div",{staticClass:"btn-add"},[t._v("节点列表")]),n("ul",{staticClass:"menu-item-list"},t._l([1,2,3,4],(function(e){return n("li",{staticClass:"relative menu-item-wrap"},[n("p",{staticClass:"menu-item",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[t._v(" 节点"+t._s(e)+" ")])])})),0)])},x=[],C=n("90fe"),w={name:"Menu",data:function(){return{x:0,y:0}},methods:{dragStart:function(t){navigator.userAgent.toLocaleLowerCase().indexOf("firefox")>0&&t&&t.dataTransfer&&t.dataTransfer.setData&&t.dataTransfer.setData("default","");var e=Object(C["d"])(6);this.$store.commit("setNodeDrag",{id:e,x:0,y:0,text:"节点".concat(e)})},dragEnd:function(t){var e=this;setTimeout((function(){e.$store.commit("setNodeDrag",null)}),500)}}},M=w,y=(n("bfd6"),Object(p["a"])(M,k,x,!1,null,null,null)),D=y.exports,N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"property-panel"},[n("div",{staticClass:"title"},[t._v("属性面板")]),t.nodeSelected?n("ul",{staticClass:"property-list"},[n("li",[t._v("id: "+t._s(t.nodeSelected.id))]),n("li",[t._v("x: "+t._s(t.nodeSelected.x))]),n("li",[t._v("y: "+t._s(t.nodeSelected.y))]),n("li",[t._v("text: "+t._s(t.nodeSelected.text))])]):t._e()])},L=[],b={name:"PropertyPanel",computed:{nodeSelected:function(){return this.$store.state.flow.nodeSelected},nodeDrag:function(){return this.$store.state.flow.nodeDrag}}},S=b,z=(n("028d"),Object(p["a"])(S,N,L,!1,null,"52754a48",null)),_=z.exports,$={iconDatabase:'\n    <g transform="scale(0.0234)">\n      <path\n        d="M832 64H192c-17.7 0-32 14.3-32 32v224h704V96c0-17.7-14.3-32-32-32zM288 232c-22.1 0-40-17.9-40-40s17.9-40 40-40 40 17.9 40 40-17.9 40-40 40zM160 928c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V704H160v224z m128-136c22.1 0 40 17.9 40 40s-17.9 40-40 40-40-17.9-40-40 17.9-40 40-40zM160 640h704V384H160v256z m128-168c22.1 0 40 17.9 40 40s-17.9 40-40 40-40-17.9-40-40 17.9-40 40-40z"\n        p-id="1218" fill="#1296db"></path>\n    </g>\n    ',iconLoading:'\n    <g transform="scale(0.0234)" fill="#1296db">\n      <path\n        d="M301.812 510.388c0 17.766-14.404 32.153-32.153 32.153h-162.877c-17.766 0-32.153-14.389-32.153-32.153 0-17.748 14.389-32.153 32.153-32.153h162.877c17.748 0 32.153 14.404 32.153 32.153z"\n        p-id="2063"></path>\n      <path\n        d="M948.383 510.388c0 17.766-14.389 32.153-32.153 32.153h-162.877c-17.748 0-32.153-14.389-32.153-32.153 0-17.748 14.404-32.153 32.153-32.153h162.877c17.766 0 32.153 14.404 32.153 32.153z"\n        p-id="2064"></path>\n      <path\n        d="M543.659 105.664v162.877c0 17.766-14.389 32.153-32.153 32.153s-32.153-14.389-32.153-32.153v-162.877c0-17.766 14.389-32.153 32.153-32.153 17.766 0 32.153 14.389 32.153 32.153z"\n        p-id="2065"></path>\n      <path\n        d="M543.659 752.236v162.892c0 17.748-14.389 32.153-32.153 32.153s-32.153-14.404-32.153-32.153v-162.892c0-17.748 14.389-32.153 32.153-32.153 17.766 0 32.153 14.404 32.153 32.153z"\n        p-id="2066"></path>\n      <path\n        d="M329.932 405.486c-5.947 10.322-16.77 16.077-27.86 16.077-5.465 0-10.996-1.383-16.061-4.308l-141.045-81.478c-15.371-8.89-20.627-28.553-11.753-43.924 8.89-15.385 28.553-20.643 43.924-11.769l141.045 81.478c15.371 8.89 20.643 28.553 11.753 43.924z"\n        p-id="2067"></path>\n      <path\n        d="M889.799 728.941c-5.964 10.304-16.77 16.077-27.877 16.077-5.45 0-10.979-1.397-16.045-4.327l-141.045-81.478c-15.371-8.877-20.643-28.553-11.753-43.924 8.877-15.385 28.553-20.643 43.924-11.753l141.045 81.478c15.371 8.877 20.627 28.553 11.753 43.924z"\n        p-id="2068"></path>\n      <path\n        d="M741.809 176.035l-81.478 141.027c-5.947 10.304-16.77 16.077-27.877 16.077-5.45 0-10.979-1.397-16.045-4.327-15.385-8.877-20.643-28.539-11.753-43.924l81.478-141.027c8.877-15.385 28.539-20.643 43.924-11.769 15.371 8.89 20.643 28.553 11.753 43.939z"\n        p-id="2069"></path>\n      <path\n        d="M418.372 735.885l-81.478 141.045c-5.964 10.304-16.77 16.077-27.877 16.077-5.465 0-10.996-1.397-16.061-4.327-15.371-8.89-20.643-28.553-11.753-43.924l81.478-141.045c8.89-15.371 28.553-20.627 43.924-11.753 15.385 8.89 20.643 28.553 11.769 43.924z"\n        p-id="2070"></path>\n      <path\n        d="M406.716 328.75c-5.047 2.925-10.579 4.308-16.027 4.308-11.125 0-21.931-5.772-27.877-16.093l-81.397-141.074c-8.877-15.385-3.601-35.047 11.783-43.924s35.047-3.601 43.924 11.783l81.381 141.074c8.877 15.385 3.601 35.047-11.783 43.924z"\n        p-id="2071"></path>\n      <path\n        d="M729.815 888.826c-5.063 2.909-10.597 4.308-16.045 4.308-11.108 0-21.931-5.772-27.877-16.093l-81.381-141.091c-8.877-15.385-3.601-35.047 11.783-43.924 15.371-8.877 35.033-3.585 43.906 11.783l81.397 141.091c8.877 15.385 3.601 35.047-11.783 43.924z"\n        p-id="2072"></path>\n      <path\n        d="M878.144 336.001l-141.074 81.397c-5.063 2.909-10.597 4.308-16.045 4.308-11.108 0-21.931-5.772-27.877-16.093-8.877-15.385-3.601-35.047 11.783-43.924l141.091-81.397c15.371-8.859 35.033-3.585 43.906 11.783 8.877 15.385 3.601 35.047-11.783 43.924z"\n        p-id="2073"></path>\n      <path\n        d="M318.083 659.102l-141.091 81.381c-5.047 2.925-10.579 4.308-16.027 4.308-11.125 0-21.931-5.772-27.877-16.093-8.877-15.385-3.601-35.047 11.783-43.924l141.074-81.381c15.385-8.877 35.047-3.601 43.924 11.783s3.601 35.047-11.783 43.924z"\n        p-id="2074"></path>\n    </g>\n    '},O={nodes:[{id:"helloWorld",x:300,y:100,text:"Hello World,Hello World",leftIcon:"iconDatabase",rightIcon:"iconLoading"},{id:"helloJune",x:200,y:200,text:"两只小花狗它们爱吃肉骨头"},{id:"helloKitty",x:100,y:300,text:"两只小花狗Hello Kitty"}],links:[{source:"helloWorld",target:"helloJune",text:"这是一条备注哦哦哦哦哦哦哦"},{source:"helloJune",target:"helloKitty",text:"July"}]},E={name:"App",components:{D3Tree:m,Menu:D,PropertyPanel:_},data:function(){return{nodes:O.nodes,links:O.links,iconData:$,width:900,height:600,transform:{x:0,y:0,k:1}}},mounted:function(){},methods:{handleActions:function(t){console.log(t)},fullscreen:function(){console.log("fullScreen")},svgDrop:function(t){var e=Object(C["b"])(t),n=e.offsetX,i=e.offsetY;this.nodeDrag&&this.$refs.graph.addNode(n,i,this.nodeDrag)},nodeContextMenu:function(t){var e=t.node,n=t.e,i=Object(C["b"])(n,this.$refs.graph.getSvgEle()),s=i.offsetX,o=i.offsetY;this.$store.commit("setNodeMenuData",{show:!0,left:s+6,top:o,node:e})},resetNodeMenu:function(){this.$store.commit("setNodeMenuData",{show:!1,left:0,top:0,node:null})},resetLinkMenu:function(){this.$store.commit("setLinkMenuData",{show:!1,left:0,top:0,link:null})},nodeEdit:function(){var t=this.nodeMenuData.node.id;this.$refs.graph.setNodeData(t,(function(t){return Object(o["a"])(Object(o["a"])({},t),{},{text:"hello"})})),this.resetNodeMenu()},nodeDelete:function(){var t=this.nodeMenuData.node.id;this.$refs.graph.removeNode(t),this.resetNodeMenu()},linkEdit:function(){var t=this.linkMenuData.link,e=t.source,n=t.target;this.$refs.graph.setLinkData(e,n,(function(t){return Object(o["a"])(Object(o["a"])({},t),{},{text:"june"})})),this.resetLinkMenu()},linkDelete:function(){var t=this.linkMenuData.link,e=t.source,n=t.target;this.$refs.graph.removeLink(e,n),this.resetLinkMenu()},linkContextMenu:function(t){var e=t.link,n=t.e,i=Object(C["b"])(n,this.$refs.graph.getSvgEle()),s=i.offsetX,o=i.offsetY;this.$store.commit("setLinkMenuData",{show:!0,left:s+6,top:o,link:e})},nodeSelectChange:function(t){this.$store.commit("setNodeSelected",t)},linkSelectChange:function(t){this.$store.commit("setLinkSelected",t)}},computed:{nodeSelected:function(){return this.$store.state.flow.nodeSelected},nodeDrag:function(){return this.$store.state.flow.nodeDrag},linkMenuData:function(){return this.$store.state.flow.linkMenuData},nodeMenuData:function(){return this.$store.state.flow.nodeMenuData}}},I=E,H=(n("c39d"),Object(p["a"])(I,i,s,!1,null,null,null));e["default"]=H.exports},"31a0":function(t,e,n){"use strict";var i=n("1c8b"),s=n("5197"),o=n("0496");i({target:"String",proto:!0,forced:o("link")},{link:function(t){return s(this,"a","href",t)}})},5197:function(t,e,n){var i=n("2732"),s=/"/g;t.exports=function(t,e,n,o){var a=String(i(t)),c="<"+e;return""!==n&&(c+=" "+n+'="'+String(o).replace(s,"&quot;")+'"'),c+">"+a+"</"+e+">"}},"842c":function(t,e,n){"use strict";var i=n("c4df"),s=n.n(i);s.a},a16d:function(t,e,n){},bfd6:function(t,e,n){"use strict";var i=n("d28b"),s=n.n(i);s.a},c39d:function(t,e,n){"use strict";var i=n("e9a9"),s=n.n(i);s.a},c4df:function(t,e,n){},d28b:function(t,e,n){},e9a9:function(t,e,n){}}]);