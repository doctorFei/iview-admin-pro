(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-89400df6"],{1784:function(t,e,n){"use strict";var i=n("1c8b"),a=n("58d8").left,s=n("d7e1"),r=n("ff9c"),o=s("reduce"),c=r("reduce",{1:0});i({target:"Array",proto:!0,forced:!o||!c},{reduce:function(t){return a(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"58d8":function(t,e,n){var i=n("0c3c"),a=n("3553"),s=n("692f"),r=n("d88d"),o=function(t){return function(e,n,o,c){i(n);var l=a(e),d=s(l),h=r(l.length),u=t?h-1:0,g=t?-1:1;if(o<2)while(1){if(u in d){c=d[u],u+=g;break}if(u+=g,t?u<0:h<=u)throw TypeError("Reduce of empty array with no initial value")}for(;t?u>=0:h>u;u+=g)u in d&&(c=n(c,d[u],u,l));return c}};t.exports={left:o(!1),right:o(!0)}},5914:function(t,e,n){"use strict";var i=n("a2f8"),a=n.n(i);a.a},"6db4":function(t,e,n){"use strict";var i=n("1c8b"),a=n("c10f").trim,s=n("f221");i({target:"String",proto:!0,forced:s("trim")},{trim:function(){return a(this)}})},"9ae4":function(t,e,n){"use strict";var i=n("c8e0"),a=n.n(i);a.a},a2f8:function(t,e,n){},bf16:function(t,e,n){t.exports=n.p+"img/test.e585c553.jpeg"},c1f8:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"main flex flex-column"},[n("div",{staticClass:"header flex justify-between items-center"},[n("p",{staticClass:"header-title"},[t._v("物品识别")]),n("Icon",{staticClass:"icon-helper",attrs:{type:"ios-help-circle"},on:{click:function(e){t.drawerShow=!0}}}),n("Drawer",{attrs:{width:300,title:"物品识别标注工具帮助",closable:!1},model:{value:t.drawerShow,callback:function(e){t.drawerShow=e},expression:"drawerShow"}},[n("p",{staticClass:"helper-title fs-16"},[t._v("支持功能")]),n("ul",{staticClass:"helper-list fs-14"},[n("li",[t._v("画布拖拽/缩放")]),n("li",[t._v("绘制矩形与多边形")]),n("li",[t._v("矩形/多边形大小位置调整")]),n("li",[t._v("多边形快捷添加/删除顶点")]),n("li",[t._v("区域列表与显示联动")])]),n("p",{staticClass:"helper-title fs-16"},[t._v("操作与快捷键说明")]),n("ul",{staticClass:"helper-list fs-14"},[n("li",[t._v("鼠标拖拽画布、区域、顶点")]),n("li",[t._v("鼠标滚轮画布缩放")]),n("li",[t._v(" 点击矩形按钮绘制矩形 -- "),n("span",{staticClass:"text-danger"},[t._v("快捷键R")])]),n("li",[t._v(" 点击多边形按钮绘制矩形 -- "),n("span",{staticClass:"text-danger"},[t._v("快捷键E")])]),n("li",[t._v(" 点击移动按钮切换为移动模式 -- "),n("span",{staticClass:"text-danger"},[t._v("快捷键M")])]),n("li",[t._v(" 绘制时按 "),n("span",{staticClass:"text-danger"},[t._v("Ctrl/Command")]),t._v("键可拖拽/缩放画布 ")]),n("li",[t._v("右击画布完成多边形绘制")]),n("li",[t._v("点击多边形边缘可添加顶点")]),n("li",[t._v("右击多边形顶点可删除顶点")]),n("li",[t._v("拖拽顶点可调整区域大小和形状")]),n("li",[t._v("拖拽区域可调整区域位置")])])])],1),n("div",{staticClass:"content relative flex flex-grow-1 h0"},[n("div",{staticClass:"content-canvas flex relative flex-grow-1"},[n("div",{staticClass:"type-select-container absolute z-999"},[n("RadioGroup",{attrs:{vertical:""},model:{value:t.actionType,callback:function(e){t.actionType=e},expression:"actionType"}},[n("Radio",{staticClass:"action-type-radio",attrs:{label:2}},[n("Icon",{attrs:{type:"ios-square-outline"}}),n("span",[t._v("矩形")])],1),n("Radio",{staticClass:"action-type-radio",attrs:{label:3}},[n("Icon",{attrs:{type:"ios-star-outline"}}),n("span",[t._v("多边形")])],1),n("Radio",{staticClass:"action-type-radio",attrs:{label:0}},[n("Icon",{attrs:{type:"ios-move"}}),n("span",[t._v("移动")])],1)],1)],1),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.menuData.show,expression:"menuData.show"}],staticClass:"menu absolute",style:"left: "+t.menuData.x+"px; top: "+t.menuData.y+"px;"},[n("li",{staticClass:"menu-item",on:{click:t.handleDeleteRegion}},[t._v("删除")])]),n("svg",{staticClass:"J_mark_svg mark-svg",class:"action-"+t.actionType,on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.handleDeleteRegion(e)},contextmenu:t.svgContextMenu}},[n("g",{ref:"area",staticClass:"J_mark",class:{"ctrl-key-down":t.ctrlKeyDown},on:{click:t.handleMarkAreaClick,mousemove:t.handleMarkAreaMouseMove,contextmenu:t.handleMarkAreaContextMenu}},[n("image",{directives:[{name:"show",rawName:"v-show",value:t.width,expression:"width"}],attrs:{id:"mark-img",width:t.width,height:t.height,"xlink:href":t.resource_url}}),n("g",{staticClass:"regions-container"},t._l(t.regionList,(function(e,i){return n("g",{key:i,staticClass:"region"},["rect"===e.type?n("rect",{directives:[{name:"show",rawName:"v-show",value:t.regionItemShow(e.metaType),expression:"regionItemShow(item.metaType)"}],staticClass:"rect",class:{hover:t.hoverIndex===i,active:t.selectedItem&&t.selectedItem.id===e.id},attrs:{x:e.x,y:e.y,width:e.width,height:e.height,fill:"rgba(94, 158, 224, 0.5)",stroke:"#6da1ff","stroke-width":"1"},on:{mousedown:function(n){return t.handleRegionClick(e.id,n)},click:t.handleStopPropagation,contextmenu:function(e){return t.handleRegionContextMenu(e)},mouseenter:function(e){return t.handleRegionMetaMouseIn(i)},mouseleave:function(e){return t.handleRegionMetaMouseLeave(i)}}}):t._e(),n("g",{directives:[{name:"show",rawName:"v-show",value:t.selectedItem&&t.selectedItem.id===e.id&&t.regionItemShow(e.metaType),expression:"selectedItem && (selectedItem.id === item.id) && regionItemShow(item.metaType)"}]},t._l(t.selectedItemPoints,(function(e,i){return n("circle",{key:i,staticClass:"point",class:"point-control-"+t.getPointActionType(i),attrs:{"data-point-action-type":t.getPointActionType(i),r:t.circleRadius,cx:e.x,cy:e.y}})})),0),"polygon"===e.type?n("polygon",{directives:[{name:"show",rawName:"v-show",value:t.regionItemShow(e.metaType),expression:"regionItemShow(item.metaType)"}],staticClass:"polygon",class:{hover:t.hoverIndex===i,active:t.selectedItem&&t.selectedItem.id===e.id},attrs:{stroke:"#6da1ff","stroke-width":"1",fill:"rgba(94, 158, 224, 0.5)",points:t.getPolygonPoints(e)},on:{mousedown:function(n){return t.handleRegionClick(e.id,n)},click:t.handleStopPropagation,contextmenu:function(e){return t.handleRegionContextMenu(e)},mouseenter:function(e){return t.handleRegionMetaMouseIn(i)},mouseleave:function(e){return t.handleRegionMetaMouseLeave(i)}}}):t._e(),"polygon"===e.type?n("g",t._l(e.points,(function(i,a){return n("line",{key:a,staticClass:"polyline",attrs:{stroke:"transparent","stroke-width":"10",fill:"none",x1:i.x,y1:i.y,x2:a===e.points.length-1?e.points[0].x:e.points[a+1].x,y2:a===e.points.length-1?e.points[0].y:e.points[a+1].y},on:{click:function(n){return t.handlePolyLine(e,a,n)}}})})),0):t._e(),n("g",{directives:[{name:"show",rawName:"v-show",value:t.selectedItem&&t.selectedItem.id===e.id&&t.regionItemShow(e.metaType),expression:"selectedItem && (selectedItem.id === item.id) && regionItemShow(item.metaType)"}]},t._l(e.points,(function(i,a){return n("circle",{key:a,staticClass:"point point-control",attrs:{"data-point-action-type":"polygon","data-index":a,r:t.circleRadius,cx:i.x,cy:i.y},on:{contextmenu:function(n){return t.handlePolygonPointContextMenu(e,a,n)}}})})),0)])})),0),t.currentDraw&&"rect"===t.currentDraw.type&&t.currentDraw.start.x!==t.currentDraw.drag.x?n("g",[n("rect",{attrs:{x:Math.min(t.currentDraw.start.x,t.currentDraw.drag.x),y:Math.min(t.currentDraw.start.y,t.currentDraw.drag.y),height:Math.abs(t.currentDraw.drag.y-t.currentDraw.start.y),width:Math.abs(t.currentDraw.drag.x-t.currentDraw.start.x),fill:"rgba(94, 158, 224, 0.5)",stroke:"#6da1ff","stroke-width":"1"}})]):t._e(),t.currentDraw&&"polygon"===t.currentDraw.type?n("g",[n("polygon",{attrs:{stroke:"#6da1ff","stroke-width":"1",fill:"rgba(94, 158, 224, 0.5)",points:t.getCurrentPolygonPoints()}}),t._l(t.currentDraw.points,(function(e,i){return n("circle",{key:i,staticClass:"point point-control",attrs:{"data-point-action-type":"polygon",r:t.circleRadius,cx:e.x,cy:e.y},on:{click:function(e){return t.handleMarkAreaContextMenu(e,!0)}}})}))],2):t._e()])])]),n("div",{staticClass:"panel-right relative"},[n("div",{staticClass:"tool-container absolute flex"},[n("Tooltip",{attrs:{content:"放大",placement:"top"}},[n("svg",{staticClass:"icon-enlarge",attrs:{viewBox:"0 0 1024 1024",width:"32",height:"32"},on:{click:function(e){return t.svgZoom(!0)}}},[n("path",{attrs:{d:"M465.27431111 762.21276615c-155.64772125 0-282.27483648-126.62711523-282.27483762-282.27483648 0-155.64772125 126.62853405-282.27625643 282.27483762-282.27625642s282.27483648 126.62853405 282.27483648 282.27625642-126.62711523 282.27483648-282.27483648 282.27483648z m0-536.15794404c-139.99110258 0-253.88310642 113.89200498-253.88310756 253.88452637 0 139.99110258 113.89200498 253.88310642 253.88310756 253.88310755s253.88310642-113.89200498 253.88310642-253.88310755c0-139.99252139-113.89058503-253.88452637-253.88310642-253.88452637z"}}),n("path",{attrs:{d:"M875.82724096 857.53515918a14.13908139 14.13908139 0 0 1-9.4033408-3.56600035L656.60617842 668.25459485c-5.87141006-5.19710606-6.41795072-14.16747349-1.22084466-20.03888242 5.19568611-5.86857017 14.16605355-6.41795072 20.03888242-1.22084466l209.81772288 185.71456284c5.87141006 5.19710606 6.41795072 14.16747349 1.22084465 20.03888356a14.16747349 14.16747349 0 0 1-10.63554275 4.78684501zM465.27431111 641.14900992c-7.84037661 0-14.19586446-6.35690781-14.1958656-14.19586446V340.16544313c0-7.84037661 6.35548899-14.19586446 14.1958656-14.19586446s14.19586446 6.35548899 14.19586446 14.19586446v286.78628238c0 7.84037661-6.35548899 14.19728441-14.19586446 14.19728441z"}}),n("path",{attrs:{d:"M608.66958109 497.7565787H321.88187875c-7.84037661 0-14.19586446-6.35548899-14.19586446-14.19586446s6.35548899-14.19586446 14.19586446-14.1958656h286.78770234c7.83895666 0 14.19586446 6.35548899 14.1958656 14.1958656s-6.35548899 14.19586446-14.1958656 14.19586446z"}})])]),n("Tooltip",{attrs:{content:"缩小",placement:"top"}},[n("svg",{staticClass:"icon-shrink",attrs:{viewBox:"0 0 1024 1024",width:"32",height:"32"},on:{click:function(e){return t.svgZoom(!1)}}},[n("path",{attrs:{d:"M465.27431111 762.21276615c-155.64772125 0-282.27483648-126.62711523-282.27483762-282.27483648 0-155.64772125 126.62853405-282.27625643 282.27483762-282.27625642s282.27483648 126.62853405 282.27483648 282.27625642-126.62711523 282.27483648-282.27483648 282.27483648z m0-536.15794404c-139.99110258 0-253.88310642 113.89200498-253.88310756 253.88452637 0 139.99110258 113.89200498 253.88310642 253.88310756 253.88310755s253.88310642-113.89200498 253.88310642-253.88310755c0-139.99252139-113.89058503-253.88452637-253.88310642-253.88452637z"}}),n("path",{attrs:{d:"M875.82724096 857.53515918a14.13908139 14.13908139 0 0 1-9.4033408-3.56600035L656.60617842 668.25459485c-5.87141006-5.19710606-6.41795072-14.16747349-1.22084466-20.03888242 5.19568611-5.86857017 14.16605355-6.41795072 20.03888242-1.22084466l209.81772288 185.71456284c5.87141006 5.19710606 6.41795072 14.16747349 1.22084465 20.03888356a14.16747349 14.16747349 0 0 1-10.63554275 4.78684501zM608.66958109 497.7565787H321.88187875c-7.84037661 0-14.19586446-6.35548899-14.19586446-14.19586446s6.35548899-14.19586446 14.19586446-14.1958656h286.78770234c7.83895666 0 14.19586446 6.35548899 14.1958656 14.1958656s-6.35548899 14.19586446-14.1958656 14.19586446z"}})])]),n("Tooltip",{attrs:{content:"适应画布",placement:"top"}},[n("svg",{staticClass:"icon-adjust-screen",attrs:{width:"22",height:"22",viewBox:"0 0 182 174"},on:{click:t.adjustScreen}},[n("path",{attrs:{d:"M65.000,108.000 L66.000,108.000 L66.000,173.000 L65.000,173.000 L65.000,108.000 Z"}}),n("path",{attrs:{d:"M66.000,108.000 L66.000,109.000 L1.000,109.000 L1.000,108.000 L66.000,108.000 Z"}}),n("path",{attrs:{d:"M117.000,108.000 L116.000,108.000 L116.000,173.000 L117.000,173.000 L117.000,108.000 Z"}}),n("path",{attrs:{d:"M116.000,108.000 L116.000,109.000 L181.000,109.000 L181.000,108.000 L116.000,108.000 Z"}}),n("path",{attrs:{d:"M65.000,66.000 L66.000,66.000 L66.000,1.000 L65.000,1.000 L65.000,66.000 Z"}}),n("path",{attrs:{d:"M66.000,66.000 L66.000,65.000 L1.000,65.000 L1.000,66.000 L66.000,66.000 Z"}}),n("path",{attrs:{d:"M117.000,66.000 L116.000,66.000 L116.000,1.000 L117.000,1.000 L117.000,66.000 Z"}}),n("path",{attrs:{d:"M116.000,66.000 L116.000,65.000 L181.000,65.000 L181.000,66.000 L116.000,66.000 Z"}}),n("circle",{attrs:{cx:"91",cy:"87",r:"18",fill:"#555"}})])]),n("Tooltip",{attrs:{content:"原始大小",placement:"top"}},[n("svg",{staticClass:"icon-reset",attrs:{viewBox:"0 0 1024 1024",width:"32",height:"32"},on:{click:function(e){return t.svgZoom(!0,1)}}},[n("path",{attrs:{d:"M128 368h512v16H128zM624 384h16v512h-16zM128 880h496v16H128zM128 384h16v496h-16zM384 128h16v240h-16zM400 128h496v16H400zM880 144h16v496h-16z"}}),n("path",{attrs:{d:"M624 624h272v16H624z"}})])])],1),n("div",{staticClass:"h-100 flex flex-column"},[t._m(0),n("p",{directives:[{name:"show",rawName:"v-show",value:!t.regionList.length,expression:"!regionList.length"}],staticClass:"empty-tip"},[t._v("请在左侧操作区选择矩形或多边形绘制工具绘制对应的标注区域~")]),n("ul",{staticClass:"content-region-list h-0 flex-grow-1 overflow-auto"},t._l(t.regionList,(function(e,i){return n("li",{key:i,staticClass:"item",class:{hover:t.hoverIndex===i,active:t.selectedItem&&t.selectedItem.id===e.id},on:{mouseenter:function(e){return t.handleRegionMetaMouseIn(i)},mouseleave:function(e){return t.handleRegionMetaMouseLeave(i)},click:function(e){return t.handleRegionSelect(i)}}},[n("div",{staticClass:"flex items-center"},[n("div",{staticClass:"flex items-center",staticStyle:{width:"25%","min-width":"100px"}},[n("p",{staticClass:"field-index"},[t._v(t._s(i+1))]),n("p",{staticClass:"ml-15 field-type"},[t._v(t._s("rect"===e.type?"矩形":"多边形"))])]),n("Input",{staticClass:"ml-15 flex-grow-1 w0",attrs:{disabled:t.readOnly,type:"text",placeholder:"请输入物品类别"},model:{value:e.text,callback:function(n){t.$set(e,"text",n)},expression:"item.text"}}),n("Icon",{staticClass:"icon-trash",attrs:{type:"ios-trash"},on:{click:function(n){return t.handleDeleteRegion(e.id)}}})],1),t._l(t.mark_tags,(function(e){return n("div",{key:e.tag,staticClass:"flex items-center",staticStyle:{padding:"10px 0"}},[n("Tooltip",{staticStyle:{width:"25%","min-width":"100px"},attrs:{content:e.tag,placement:"right"}},[n("div",{staticClass:"flex items-center justify-end"},[n("p",{staticClass:"ellipsis",staticStyle:{"padding-top":"3px","text-align":"right"}},[t._v(t._s(e.tag))]),t._v(": ")])]),e.isMulti?n("Select",{staticClass:"flex-grow-1",staticStyle:{"margin-left":"15px",width:"0","margin-right":"35px"},attrs:{clearable:"",disabled:t.readOnly,multiple:""},model:{value:t.getTargetTag(e.tag,i).types,callback:function(n){t.$set(t.getTargetTag(e.tag,i),"types",n)},expression:"getTargetTag(tagItem.tag, index).types"}},t._l(e.tagTypeList,(function(e){return n("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1):t._e(),e.isMulti?t._e():n("Select",{staticClass:"flex-grow-1",staticStyle:{"margin-left":"15px",width:"0","margin-right":"35px"},attrs:{clearable:"",disabled:t.readOnly},model:{value:t.getTargetTag(e.tag,i).type,callback:function(n){t.$set(t.getTargetTag(e.tag,i),"type",n)},expression:"getTargetTag(tagItem.tag, index).type"}},t._l(e.tagTypeList,(function(e){return n("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1)}))],2)})),0)])])])])},a=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"label-title flex items-center justify-between"},[n("p",[t._v("区域")])])}],s=(n("b4fb"),n("dbb3"),n("4194"),n("3466"),n("fe59"),n("ecb4"),n("2eeb"),n("1784"),n("ea69"),n("e35a"),n("f4e3"),n("6db4"),n("08ba"),n("5748")),r=n("1998"),o=n("e793");n("f3dd"),n("fe8a");function c(t,e){if(null==t)return{};var n,i,a={},s=Object.keys(t);for(i=0;i<s.length;i++)n=s[i],e.indexOf(n)>=0||(a[n]=t[n]);return a}function l(t,e){if(null==t)return{};var n,i,a=c(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)n=s[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}n("6a61");var d=n("cf7f"),h=n("715e"),u=n("bf16"),g=n.n(u),p=n("90fe"),m=function(t,e){var n=t||window.event,i=e||n.target||n.srcElement;return{offsetX:n.clientX-i.getBoundingClientRect().left,offsetY:n.clientY-i.getBoundingClientRect().top}},f={move:0,select:1,drawRect:2,drawPolygon:3},v=["tl","tm","tr","ml","mr","bl","bm","br"],y={name:"Main",components:{},data:function(){return{msg:"Welcome to Your Vue.js App",readOnly:!1,resource_url:"",svg:null,ctrlKeyDown:!1,ready:!1,width:0,height:0,circleRadius:6,drawerShow:!1,menuData:{show:!1,x:0,y:0},transform:{x:0,y:0,k:1},zoom:null,actionType:f.move,enumActionType:f,regionList:[],currentDraw:null,selectedItem:null,pointMove:null,hoverIndex:-1,filterType:"全部",mark_tags:[],tagRes:[]}},mounted:function(){window.initMarkData=this.initData,window.markSubmit=this.handleSubmit,window.markBad=this.handleMarkBad,this.svg=h["d"](".J_mark_svg"),this.initZoom(),this.initDragEvent(),this.initKeyEvents(),this.handleNext()},computed:{selectedItemPoints:function(){if(this.selectedItem&&"rect"===this.selectedItem.type){var t=this.selectedItem,e=t.x,n=t.y,i=t.width,a=t.height;return[{x:e,y:n},{x:e+i/2,y:n},{x:e+i,y:n},{x:e,y:n+a/2},{x:e+i,y:n+a/2},{x:e,y:n+a},{x:e+i/2,y:n+a},{x:e+i,y:n+a}]}return[]}},watch:{selectedItem:function(){var t=this;this.$nextTick((function(){t.initPointsDragEvent()}))}},methods:{getTargetTag:function(t,e){var n=this.regionList[e].tags.findIndex((function(e){return e.tag===t}));return this.regionList[e].tags[n]},handleSelectChange:function(t,e){["image","video"].indexOf(t.metaType)>-1&&(t.text="")},handleNext:function(){window.initMarkData({resource_url:g.a,readOnly:!1,mark_tags:[{tag:"标签1标签1标签1标签1标签1标签1",isMulti:0,tagTypeList:["1","2","3"]},{tag:"标签2",isMulti:1,tagTypeList:["a","b","c"]}],mark_result:{bad:!1,width:1e3,height:900,file:g.a,regions:[{height:419.2394561767578,metaType:"image",text:"",type:"rect",width:350.2183532714844,x:290.8309631347656,y:148.2675018310547,tags:[{tag:"标签1标签1标签1标签1标签1标签1",type:"1"},{tag:"标签2",types:["a","b"]}]},{height:311.873291015625,metaType:"text",text:"dasdas",type:"rect",width:278.6408996582031,x:301.0563049316406,y:677.4295043945312,tags:[{tag:"标签1标签1标签1标签1标签1标签1",type:"2"},{tag:"标签2",types:["a","c"]}]}]}})},initData:function(t){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){var i,a,s,r,o,c,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=t.resource_url,a=void 0===i?"":i,s=t.readOnly,r=void 0!==s&&s,o=t.mark_tags,c=void 0===o?[]:o,l=t.mark_result,e.pointMove=null,e.currentDraw=null,e.selectedItem=null,e.regionList=[],e.bad=!1,e.ready=!1,e.readOnly=r,e.mark_tags=c,e.width=0,e.height=0,e.resource_url=a,e.initImage(l);case 13:case"end":return n.stop()}}),n)})))()},handleSubmit:function(){if(!this.ready)return this.$Message.error({content:"图片尚未加载完成"}),{valid:!1,data:null};if(!this.regionList.length)return this.$Message.error({content:"标注结果提交失败，未标注任何区域"}),{valid:!1,data:null};if(this.pointMove)return this.$Message.error({content:"标注结果提交失败，多边形区域尚未绘制完成"}),{valid:!1,data:null};var t=!0;return this.regionList.forEach((function(e){e.text.trim()||(t=!1)})),t?{valid:!0,data:{file:this.resource_url,width:this.width,height:this.height,bad:!1,regions:this.regionList.map((function(t){t.id;var e=l(t,["id"]);return e}))}}:(this.$Message.error({content:"标注结果提交失败，需指定物品名称"}),{valid:!1,data:null})},handleMarkBad:function(){return{valid:!0,data:{file:this.resource_url,width:this.width,height:this.height,bad:!0,regions:[]}}},regionItemShow:function(t){var e=this.currentFilterType();return"all"===e||t===e},currentFilterType:function(){var t={"全部":"all","文字":"text","图片":"image","视频":"video"};return t[this.filterType]},initImage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{regions:[]},n=new Image;n.src=this.resource_url,n.onload=function(){var i=n.naturalWidth,a=n.naturalHeight;t.width=i,t.height=a,t.width<500&&(t.circleRadius=4),t.ready=!0;var s=e&&e.regions?e.regions:[];t.regionList=s.map((function(t){return Object(o["a"])({id:Object(p["d"])(8)},t)})),t.$nextTick((function(){t.adjustScreen(),t.initRectDragEvent()}))}},svgContextMenu:function(t){return t.preventDefault(),this.resetMenuData(),!1},resetMenuData:function(){this.menuData={show:!1,x:0,y:0}},handleRegionContextMenu:function(t){t.preventDefault(),t.stopPropagation();var e=m(t,this.svg.node()),n=e.offsetX,i=e.offsetY;this.menuData={show:!0,x:n,y:i}},handlePolygonPointContextMenu:function(t,e,n){if(n.preventDefault(),n.stopPropagation(),this.resetMenuData(),t.points.splice(e,1),t.points.length<3){var i=this.regionList.findIndex((function(e){return e.id===t.id}));this.regionList.splice(i,1),this.selectedItem=null}return!1},getCurrentPolygonPoints:function(){return"".concat(this.currentDraw.points.reduce((function(t,e){return"".concat(t?"".concat(t,","):""," ").concat(e.x," ").concat(e.y)}),"")).concat(this.pointMove?", ".concat(this.pointMove.x," ").concat(this.pointMove.y):"")},getPolygonPoints:function(t,e){if(t.points&&t.points.length){var n=t.points.reduce((function(t,e){return"".concat(t?"".concat(t,","):""," ").concat(e.x," ").concat(e.y)}),"");return e?"".concat(n,", ").concat(t.points[0].x," ").concat(t.points[0].y):n}return""},handleMarkAreaClick:function(t){if(this.resetMenuData(),!this.readOnly&&this.actionType===f.drawPolygon&&!window.event.ctrlKey&&!window.event.metaKey){var e=m(t,this.svg.node()),n=e.offsetX,i=e.offsetY,a=h["h"](this.svg.node()),o=a.invert([n,i]),c=Object(r["a"])(o,2),l=c[0],d=c[1];this.currentDraw?this.currentDraw.points=[].concat(Object(s["a"])(this.currentDraw.points),[{x:l,y:d}]):this.currentDraw={type:"polygon",points:[{x:l,y:d}]}}},handleMarkAreaMouseMove:function(t){if(!this.readOnly&&(console.log(this.actionType),this.actionType===f.drawPolygon&&this.currentDraw&&this.currentDraw.points.length&&!window.event.ctrlKey&&!window.event.metaKey)){var e=m(t,this.svg.node()),n=e.offsetX,i=e.offsetY,a=h["h"](this.svg.node()),s=a.invert([n,i]),o=Object(r["a"])(s,2),c=o[0],l=o[1];this.pointMove={x:c,y:l}}},handleMarkAreaContextMenu:function(t,e){var n=this;t.stopPropagation(),t.preventDefault(),this.readOnly||(this.resetMenuData(),this.actionType!==f.drawPolygon||!this.pointMove||window.event.ctrlKey||window.event.metaKey||(e||this.currentDraw.points.find((function(t){return Math.abs(t.x-n.pointMove.x)+Math.abs(t.y-n.pointMove.y)<30}))?t.stopPropagation():this.currentDraw.points=[].concat(Object(s["a"])(this.currentDraw.points),[this.pointMove]),this.currentDraw.points.length>2&&(this.regionList=[].concat(Object(s["a"])(this.regionList),[{id:Object(p["d"])(8),type:"polygon",points:this.currentDraw.points,text:"",tags:this.mark_tags.map((function(t){return Object(o["a"])({tag:t.tag},t.isMulti?{types:[]}:{type:null})}))}]),this.selectedItem=this.regionList[this.regionList.length-1]),this.pointMove=null,this.currentDraw=null,this.$nextTick((function(){n.initPolygonDragEvent(),n.initPointsDragEvent()}))))},handleDeleteRegion:function(t){var e=this;this.readOnly||(this.selectedItem||t?this.$Modal.confirm({title:"删除区域",content:"是否要删除该区域?",okText:"删除",cancelText:"取消",onOk:function(){var n=e.regionList.findIndex((function(n){return n.id===(e.selectedItem?e.selectedItem.id:t)}));e.regionList.splice(n,1),e.selectedItem=null,e.resetMenuData()},onCancel:function(){e.resetMenuData()}}):this.resetMenuData())},handleRegionClick:function(t,e){e.stopPropagation(),this.resetMenuData(),this.selectedItem&&this.selectedItem.id===t||(this.selectedItem=this.regionList.find((function(e){return e.id===t})))},handlePolyLine:function(t,e,n){var i=this;if(n.stopPropagation(),!this.readOnly){this.resetMenuData(),this.selectedItem=t;var a=m(n,this.svg.node()),s=a.offsetX,o=a.offsetY,c=h["h"](this.svg.node()),l=c.invert([s,o]),d=Object(r["a"])(l,2),u=d[0],g=d[1];t.points.splice(e+1,0,{x:u,y:g}),this.$nextTick((function(){i.initPointsDragEvent()}))}},handleStopPropagation:function(t){t.stopPropagation(),this.resetMenuData()},getPointActionType:function(t){return v[t]},handleRegionSelect:function(t){this.selectedItem=this.regionList[t]},initZoom:function(){var t=this,e=this;this.zoom=h["f"]().on("start",(function(){t.resetMenuData(),e.svg.classed("active",!1)})).on("zoom",(function(){var t=h["b"].transform,e=t.x,n=t.y,i=t.k;h["d"](".J_mark").attr("transform",h["g"].translate(e,n).scale(i))})).on("end",(function(){e.svg.classed("active",!1)})).filter((function(e){return"mark-img"!==h["b"].target.id||t.actionType===f.move||window.event.ctrlKey||window.event.metaKey})),e.svg.call(this.zoom).on("dblclick.zoom",null),e.svg.call(this.zoom.transform,h["g"].translate(this.transform.x,this.transform.y).scale(this.transform.k))},svgZoom:function(t,e){if(e)this.zoom.scaleTo(h["d"](this.svg.node()),e);else{var n=t?1.1:.9;this.zoom.scaleBy(h["d"](this.svg.node()),n)}},adjustScreen:function(){var t=h["d"](this.svg.node()),e=document.getElementsByClassName("J_mark")[0],n=this.svg.node().getBoundingClientRect(),i=e.getBoundingClientRect(),a=n.width/i.width,s=n.height/i.height,r=1;r=a<s?a:s;var o=r;this.zoom.scaleBy(t,o);var c=e.getAttribute("transform").match(/scale\(([.\d]+)\)/),l=c&&c[1]?parseFloat(c[1]):1,d=e.getBoundingClientRect(),u=n.x,g=n.y,p=n.width,m=n.height,f=n.top,v=n.left,y=d.x,w=d.y,x=d.width,I=d.height,b=d.top,k=d.left,M=u||v||0,D=y||k||0,_=g||f||0,C=w||b||0,L=M+p/2-x/2-D,T=_+m/2-I/2-C;this.zoom.translateBy(t,L/l,T/l)},handleRectDraw:function(t){this.actionType=t?f.drawRect:f.move},handlePolygonDraw:function(t){this.actionType=t?f.drawPolygon:f.move},initDragEvent:function(){var t=this;h["d"]("#mark-img").call(h["a"]().on("start",(function(e){t.resetMenuData(),t.currentDraw={type:"rect",start:{x:h["b"].x,y:h["b"].y},drag:{x:h["b"].x,y:h["b"].y}}})).on("drag",(function(e){var n=h["b"],i=n.dx,a=n.dy;t.currentDraw.drag.x+=i,t.currentDraw.drag.y+=a})).on("end",(function(e){var n=t.currentDraw,i=n.start,a=i.x,r=i.y,c=n.drag,l=c.x,d=c.y;if(a!==l&&r!==d){var h=Math.abs(l-a),u=Math.abs(d-r);t.regionList=[].concat(Object(s["a"])(t.regionList),[{id:Object(p["d"])(8),type:"rect",x:Math.min(a,l),y:Math.min(r,d),width:h<10?10:h,height:u<10?10:u,text:"",tags:t.mark_tags.map((function(t){return Object(o["a"])({tag:t.tag},t.isMulti?{types:[]}:{type:null})}))}]),t.currentDraw=null,t.selectedItem=t.regionList[t.regionList.length-1],t.rectLimit(),t.$nextTick((function(){t.initRectDragEvent(),t.initPointsDragEvent()}))}else t.currentDraw=null})).filter((function(e){return t.actionType===f.drawRect&&!t.readOnly&&!window.event.ctrlKey&&!window.event.metaKey})))},initPointsDragEvent:function(){var t=this,e="",n="";h["e"]("circle.point").call(h["a"]().on("start",(function(i){t.resetMenuData(),e=h["b"].sourceEvent.target.getAttribute("data-point-action-type"),n=h["b"].sourceEvent.target.getAttribute("data-index"),h["b"].sourceEvent.stopPropagation()})).on("drag",(function(i){h["b"].sourceEvent.stopPropagation();var a=h["b"],s=a.dx,r=a.dy,o=t.selectedItem,c=(o.x,o.y,o.width),l=o.height;switch(e){case"tl":c>=10&&l>=10&&(t.selectedItem.x+=s,t.selectedItem.y+=r,t.selectedItem.width-=s,t.selectedItem.height-=r),c<10&&s<0&&(t.selectedItem.x+=s,t.selectedItem.width-=s),l<10&&r<0&&(t.selectedItem.y+=r,t.selectedItem.height-=r),c<5&&(t.selectedItem.width=5),l<5&&(t.selectedItem.height=5);break;case"tm":(l>=10||l<10&&r<0)&&(t.selectedItem.y+=r,t.selectedItem.height-=r),l<5&&(t.selectedItem.height=5);break;case"tr":c>=10&&l>=10&&(t.selectedItem.y+=r,t.selectedItem.height-=r,t.selectedItem.width+=s),c<10&&(t.selectedItem.width=10),l<10&&r<0&&(t.selectedItem.y+=r,t.selectedItem.height-=r),l<5&&(t.selectedItem.height=5);break;case"ml":(c>=10||c<10&&s<0)&&(t.selectedItem.x+=s,t.selectedItem.width-=s),c<5&&(t.selectedItem.width=5);break;case"mr":(c>=10||c<10&&s<0)&&(t.selectedItem.width+=s),c<10&&(t.selectedItem.width=10);break;case"bl":c>=10&&l>=10&&(t.selectedItem.x+=s,t.selectedItem.height+=r,t.selectedItem.width-=s),l<10&&(t.selectedItem.height=10),c<10&&s<0&&(t.selectedItem.x+=s,t.selectedItem.width-=s),c<5&&(t.selectedItem.width=5);break;case"bm":(l>=10||l<10&&r>0)&&(t.selectedItem.height+=r),l<5&&(t.selectedItem.height=5);break;case"br":c>=10&&l>=10&&(t.selectedItem.width+=s,t.selectedItem.height+=r),c<10&&(t.selectedItem.width=10),l<10&&(t.selectedItem.height=10);break;case"polygon":var d=t.selectedItem.points[n];d.x+=s,d.y+=r,d.x<=0&&(d.x=0),d.y<=0&&(d.y=0),d.x>=t.width&&(d.x=t.width),d.y>=t.height&&(d.y=t.height);break;default:break}})).on("end",(function(e){h["b"].sourceEvent.stopPropagation(),"rect"===t.selectedItem.type&&t.rectLimit()})).filter((function(e){return!t.readOnly})))},rectLimit:function(){this.selectedItem.x<=0&&(this.selectedItem.x=0),this.selectedItem.y<=0&&(this.selectedItem.y=0),this.selectedItem.width>this.width&&(this.selectedItem.width=this.width),this.selectedItem.height>this.height&&(this.selectedItem.height=this.height),this.selectedItem.x+this.selectedItem.width>=this.width&&(this.selectedItem.x=this.width-this.selectedItem.width),this.selectedItem.y+this.selectedItem.height>=this.height&&(this.selectedItem.y=this.height-this.selectedItem.height)},initRectDragEvent:function(){var t=this;h["e"]("rect.rect").call(h["a"]().on("start",(function(e){t.resetMenuData(),h["b"].sourceEvent.stopPropagation()})).on("drag",(function(e){h["b"].sourceEvent.stopPropagation();var n=h["b"],i=n.dx,a=n.dy;t.selectedItem.x+=i,t.selectedItem.y+=a,t.rectLimit()})).on("end",(function(t){h["b"].sourceEvent.stopPropagation()})).filter((function(e){return!t.readOnly})))},initPolygonDragEvent:function(){var t=this;h["e"]("polygon.polygon").call(h["a"]().on("start",(function(e){t.resetMenuData(),h["b"].sourceEvent.stopPropagation()})).on("drag",(function(e){h["b"].sourceEvent.stopPropagation();for(var n=h["b"],i=n.dx,a=n.dy,s=t.selectedItem.points.length,r=!0,c=!0,d=0;d<s;d++){var u=t.selectedItem.points[d],g=u.x,p=u.y;(g+i<0||g+i>t.width)&&(r=!1),(p+a<0||p+a>t.height)&&(c=!1)}t.selectedItem.points=t.selectedItem.points.map((function(t){var e=t.x,n=t.y,s=l(t,["x","y"]);return Object(o["a"])({x:r?e+i:e,y:c?n+a:n},s)}))})).on("end",(function(t){h["b"].sourceEvent.stopPropagation()})).filter((function(e){return!t.readOnly})))},handleRegionMetaMouseIn:function(t){this.hoverIndex=t},handleRegionMetaMouseLeave:function(t){this.hoverIndex=-1},initKeyEvents:function(){var t=this;window.addEventListener("keydown",(function(e){var n=e.ctrlKey,i=e.metaKey;switch(!0){case n:t.ctrlKeyDown=!0;break;case i:t.ctrlKeyDown=!0;break;default:break}})),window.addEventListener("keyup",(function(e){var n=e.ctrlKey,i=e.metaKey,a=e.key;switch(n||i||(t.ctrlKeyDown=!1),!0){case"e"===a:t.actionType=f.drawPolygon;break;case"r"===a:t.actionType=f.drawRect;break;case"m"===a:t.actionType=f.move;break;default:break}}))}}},w=y,x=(n("9ae4"),n("5914"),n("9ca4")),I=Object(x["a"])(w,i,a,!1,null,"608c5ec7",null);e["default"]=I.exports},c8e0:function(t,e,n){},f221:function(t,e,n){var i=n("efe2"),a=n("fc8c"),s="​᠎";t.exports=function(t){return i((function(){return!!a[t]()||s[t]()!=s||a[t].name!==t}))}}}]);